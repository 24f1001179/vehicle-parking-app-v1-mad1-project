<!DOCTYPE html>
<html class = "h-100" data-bs-theme = "dark">
    <head>
        <meta charset = "UTF-8"/>
        <meta name = "Author" content = "J S Karthik"/>
        <meta name = "Description" content = "Admin Dashboard Page"/>
        <meta name = "viewport" content = "width = device-width, initial-scale = 1.0"/>
        <title>
            Dashboard
        </title>
        <link rel = "icon" href = "\static\images\car-front-fill.svg"/>
        <link rel = "stylesheet" href = "/static/bootstrap/css/bootstrap.min.css"/>
        <link rel = "stylesheet" href = "/static/css/style.css"/>
    </head>
    <body class = "h-100">
        <div class = "container-fluid bg-body-tertiary min-vh-100">
            <div class = "container-fluid d-flex justify-content-center bg-body">
                <div class = "d-flex justify-content-center align-items-center container-fluid mt-2 rounded-4 position-fixed height" style = "background-color: rgba(33, 37, 41, 0.9); z-index: 1000; box-shadow: 0 0 10px rgb(0, 0, 0); backdrop-filter: blur(3px);">
                    <div class = "overflow-auto" style = "height: 100%; width: 100%;">
                        <ul class = "nav nav-tabs d-flex align-items-center justify-content-center" style = "height: 100%; width: 100%;">
                            <a href = "/" class = "text-decoration-none text-reset me-2">
                                <h3>
                                    ParkEase
                                    <img src = "/static\images\car-front-fill.svg" alt = "Logo" style = "width: 40px;"/>
                                </h3>
                            </a>
                            <li class = "nav-item">
                                <a class = "nav-link" href = "/admin/dashboard">
                                    Parking Lots
                                </a>
                            </li>
                            <li class = "nav-item">
                                <a class = "nav-link", href = "/admin/dashboard/users">
                                    Users
                                </a>
                            </li>
                            <li class = "nav-item">
                                <a class = "nav-link active", href = "/admin/dashboard/history">
                                    History
                                </a>
                            </li>
                            <li class = "nav-item">
                                <a class = "nav-link" href = "/admin/dashboard/summary">
                                    Summary
                                </a>
                            </li>
                            </li class = "nav-item">
                                <a class = "nav-link" href = "/signIn">
                                    Logout
                                </a>
                            </li>
                            <li class = "nav-item">
                                <a class = "nav-link" href = "/">
                                    Website
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class = "rounded-3 container-fluid bg-body p-2 overflow-auto margin-top" style = "height: 80%; width: 100%; box-shadow: 0 0 10px rgb(24, 26, 29);">
                <div class = "d-flex justify-content-center align-items-center gap-2" style = "height: 60px;">
                    <h3>
                        Reservation History
                    </h3>
                    <p>
                        <form method = "POST" action = "/admin/dashboard/searchResults" class = "d-flex">
                            <input type = "hidden" name = "type" value = "ReservedParkingSpot"/>
                            <input type = "text" name = "searchValue" class = "form-control" style = "height: 40px;"/> &nbsp;
                            <button type = "submit" name = "action" value = "search" class = "btn btn-primary btn-sm d-flex justify-content-center align-items-center" style = "height: 40px;">
                                <img src = "\static\images\search.svg" alt = "Search"/>
                            </button>
                        </form>
                    </p>
                </div>
                <div>
                    <table class = "table table-striped table-bordered table-hover text-center" style = "box-shadow: 0 0 10px rgb(7, 8, 8)">
                        <thead class = "border-secondary">
                            <tr>
                                <th class = "bg-info">
                                    Name
                                </th>
                                <th>
                                    Email Id
                                </th>
                                <th>
                                    Lot Id
                                </th>
                                <th class = "bg-info">
                                    Date
                                </th>
                                <th>
                                    Parking Time
                                </th>
                                <th>
                                    Leaving Time
                                </th>
                                <th class = "bg-info">
                                    Duration
                                </th>
                                <th class = "bg-info">
                                    Cost
                                </th>
                                <th class = "bg-info">
                                    Status
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for reservedParkingSpot in reservedParkingSpots %}
                                <tr>
                                    <td class = "bg-secondary">
                                        {{ reservedParkingSpot.user.firstName }} {{ reservedParkingSpot.user.lastName }}
                                    </td>
                                    <td>
                                        {{ reservedParkingSpot.user.email }}
                                    </td>
                                    <td>
                                        {% if reservedParkingSpot.parkingSpot is not none %}
                                            {{ reservedParkingSpot.parkingSpot.parkingLot.id }}
                                        {% else %}
                                            - 
                                        {% endif %}
                                    </td>
                                    {% if reservedParkingSpot.parkingTimestamp is none %}
                                        {% set a = 1 %}
                                        <td class = "bg-secondary">
                                            -
                                        </td>
                                        <td>
                                            -
                                        </td>
                                    {% else %}
                                        <td class = "bg-secondary">
                                            {{ reservedParkingSpot.parkingTimestamp.strftime("%b %d, %Y") }}
                                        </td>
                                        <td>
                                            {{  reservedParkingSpot.parkingTimestamp.strftime("%I:%M %p") }}
                                        </td>
                                    {% endif %}
                                    {% if reservedParkingSpot.leavingTimestamp is none %}
                                        {% set b = 1 %}
                                        <td>
                                            -
                                        </td>
                                        <td class = "bg-secondary">
                                            -
                                        </td>
                                        <td class = "bg-secondary">
                                            -
                                        </td>
                                    {% else %}
                                        <td>
                                            {{ reservedParkingSpot.leavingTimestamp.strftime("%I:%M %p") }}
                                        </td>
                                        <td class = "bg-secondary">
                                            {% set dur = (reservedParkingSpot.leavingTimestamp - reservedParkingSpot.parkingTimestamp).total_seconds() | int %}
                                            {{ "%02d" | format(dur // 3600) }}:{{ "%02d" | format((dur % 3600) // 60) }}:{{ "%02d" | format(dur % 60) }}
                                        </td>
                                        <td class = "bg-secondary">
                                            {{ reservedParkingSpot.totalCost }}
                                        </td>
                                    {% endif %}
                                    {% if a == 1 %}
                                        <td class = "bg-danger">
                                            Reserved
                                        </td>
                                    {% elif b == 1 %} 
                                        <td class = "bg-success">
                                            Occupied
                                        </td>
                                    {% else %}
                                        <td class = "bg-secondary">
                                            Parked Out
                                        </td>
                                    {% endif %}
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </body>
</html>